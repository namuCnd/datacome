<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:c="http://www.springframework.org/schema/c"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.1.xsd">

	<util:properties id="globals" location="classpath:config/globals.properties" />
	<util:properties id="datasource" location="classpath:config/datasource.properties" />
	
	<security:http pattern="/static/**" security="none" />

	<!-- 검사 URL -->
    <security:http use-expressions="true">
        <security:intercept-url pattern="/security/loginForm.do" access="permitAll" />
        <security:intercept-url pattern="/main/main.do" access="permitAll" />
        <security:intercept-url pattern="/admin/**" access="hasRole('ADMIN')" />
        <security:intercept-url pattern="/**" access="hasAnyRole('USER, ADMIN')" />
        
        <security:form-login login-page="/security/signinForm.do"
                    default-target-url="/main/main.do"
                    authentication-failure-url="/security/signinForm.do?error"
                    username-parameter="id"
                    password-parameter="password" />
        <security:logout logout-url="/security/logout"
                logout-success-url="/main/main.do" />
                
        <security:access-denied-handler error-page="/security/accessDenied.do" />
    </security:http>
    
    <!--  provider  -->
    <security:authentication-manager>
        <security:authentication-provider>
            <security:user-service>
                <security:user name="user" password="password" authorities="ROLE_USER" />
                <security:user name="admin" password="password" authorities="ROLE_ADMIN" />
            </security:user-service>
        </security:authentication-provider>
    </security:authentication-manager>
	
	<beans:bean id="customizedLogoutSuccessHandler"
		class="org.springframework.security.web.authentication.logout.SimpleUrlLogoutSuccessHandler">
		<beans:property name="useReferer" value="true" />
		<beans:property name="defaultTargetUrl" value="/main/main.do" />
	</beans:bean>
	
	<beans:bean id="customizedAuthenticationSuccessHandler" class="com.namucnd.security.handler.CustomizedAuthenticationSuccessHandler" >
		<beans:property name="defaultUrl" value="/main/main.do" />
	</beans:bean>
	
	<beans:bean id="customizedAuthenticationFailureHandler" class="com.namucnd.security.handler.CustomizedAuthenticationFailureHandler" >
		<beans:property name="loginidname" value="loginid" />		
		<beans:property name="defaultFailureUrl" value="/security/signinForm.do?fail=true" />
	</beans:bean>
	
	<beans:bean id="bcryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" >
		<beans:constructor-arg name="strength" value="11" />
	</beans:bean>
	
	<!-- 로그인 (권한정보 입력)-->
	<beans:bean id="userDetailsService" class="com.namucnd.security.service.CustomizedUserDetailsService"/>

</beans:beans>